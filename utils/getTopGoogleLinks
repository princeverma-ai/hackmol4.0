const request = require("request");
const cheerio = require("cheerio");

const getTopGoogleLinks = (searchQuery, numberOfLinks) => {
  // URL encode the search query and concatenate with Google search URL
  const searchUrl =
    "https://www.google.com/search?q=" + encodeURIComponent(searchQuery);

  return new Promise((resolve, reject) => {
    // Send a GET request to Google search URL
    request(searchUrl, (error, response, html) => {
      if (!error && response.statusCode === 200) {
        // Load the HTML response into Cheerio
        const $ = cheerio.load(html);

        // Extract the links from search results
        const links = $("a");

        console.log(links.length);

        let validLinks = [];

        for (let link of links) {
          if (link.attribs.href.startsWith("/url?q=")) {
            validLinks.push(
              link.attribs.href.split("&")[0].replace("/url?q=", "")
            );
          }
        }
        resolve(validLinks.slice(0, numberOfLinks));
      } else {
        console.error("Error scraping Google search results:", error);
        reject(error);
      }
    });
  });
};

module.exports = getTopGoogleLinks;
